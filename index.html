<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Чекер Магнит</title>
    <link rel="stylesheet" href="https://fortunemagnet.fun/styles.css">
    <script>
        var currentDigits = 0;

        function generateLuhnDigit(number) {
            // Генерация контрольной цифры по алгоритму Луна
            var numArr = number.toString().split("").map(Number);
            var sum = 0;
            for (var i = numArr.length - 1; i >= 0; i--) {
                var digit = numArr[i];
                if (i % 2 === 0) {
                    digit *= 2;
                    if (digit > 9) {
                        digit -= 9;
                    }
                }
                sum += digit;
            }
            var luhnDigit = (Math.ceil(sum / 10) * 10 - sum) % 10;
            return luhnDigit;
        }

        function changeCardNumber() {
            // Генерация новых 4 цифр
            var newDigits = currentDigits.toString().padStart(4, '0');

            // Проверка контрольной цифры по алгоритму Луна
            var luhnDigit = generateLuhnDigit(parseInt("700500082621" + newDigits));

            // Если контрольная цифра не соответствует, пропускаем текущую попытку генерации
            if (luhnDigit !== 0) {
                currentDigits++;
                if (currentDigits > 9999) {
                    currentDigits = 0;
                }
                changeCardNumber();
                return;
            }

            // Обновление текущих цифр
            currentDigits++;
            if (currentDigits > 9999) {
                currentDigits = 0;
            }

            // Заменяем последние 4 цифры в номере карты
            var cardNumberElement = document.getElementById("cardNumber");
            cardNumberElement.innerText = "7005 0008 2621 " + newDigits;

            // Обновляем QR-код
            var qrCodeImage = document.getElementById("qrCode");
            qrCodeImage.src = "https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=E700500082621" + newDigits;
        }

        setInterval(() => {
            location.reload();
        }, 500000000000); // Обновление каждые 5 секунд
    </script>
</head>

<body>
    <div id="app" class="app">
        <header class="header">
            <nav class="nav">
                <div class="coupon-header">
                    <center>
                        Карта
                    </center>
                </div>
            </nav>
        </header>
        <center>
            <div class="cart">
                <div class="cart__top d-flex flex-column align-items-center">
                    <div class="cart__discount">Бонус 0,5%</div>
                    <!-- Идентификатор добавлен для изменения содержимого -->
                    <img id="qrCode" src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=E7005000826210213T128004" alt="QR Code">
                    <br>
                    <div class="cart__block-separator"></div>
                </div>
                <!-- Идентификатор добавлен для изменения содержимого -->
                <div id="cardNumber" class="cart__title">7005 0008 2621 0000</div>
                <div class="cart__title">Покажите QR-код на кассе для списания и <br>начисления баллов</div>
                <div class="settings">
                    <!-- Перемещенная кнопка -->
                    <button onclick="changeCardNumber()">Изменить номер карты</button>
                </div>
                <div class="cart__title">Баланс: 20000.02 бонусных рублей<br>Ижевск</div>
            </div>
        </center>
    </div>
</body>

</html>
